#!/bin/bash

# Default value for the public IP
ip=""

# Function to check if a string is a valid IPv4 using regex
_is_valid_ipv4() {
    local ip="$1"
    rx='([1-9]?[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])'  # A number from 0 to 255
    if [[ "$ip" =~ ^$rx\.$rx\.$rx\.$rx$ ]]; then
        return 0  # true
    else
        return 1  # false
    fi
}

# Function to get the public IP from various sources
_get_public_ip() {
    readonly URLS=(
        "https://icanhazip.com"
        "https://api.ipify.org"
        "http://icanhazip.com"
        "http://api.ipify.org"
        "http://myexternalip.com/raw"
    )

    for url in "${URLS[@]}"; do
        ip=$(wget -qO- "$url")  # Get the public IP using wget
        ip=${ip//[[:space:]]/}  # Remove all whitespace (including internal spaces)
        if _is_valid_ipv4 "$ip"; then
            break
        fi
    done
}

# Get the public IP, if failed then exit program
_get_public_ip
if [ -z "$ip" ]; then
    echo "Could not get the public IP"
    exit 1
else
    echo "The public IP is: $ip"
fi
